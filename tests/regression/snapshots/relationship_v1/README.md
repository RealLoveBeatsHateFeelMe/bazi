# Relationship Feature Regression Snapshots v1

**创建时间**: 2026-01-30
**目的**: Q8/Q4感情功能的regression基准测试

---

## 快照说明

这些快照是从**打印层**直接提取的，代表了当前程序对感情相关事件的输出标准。

### 快照来源

所有快照都是通过运行 `run_cli()` 函数直接生成的打印层输出，**不是从JSON提取**。

### 关键检测点

每个快照中应该包含的感情相关信息：

1. **配偶星hints** (在 `- HINTS -` 区块):
   - `[感情] 缘分(地支): 易遇合适伴侣（良缘）` - 地支配偶星（重点）
   - `[感情] 缘分(天干): 暧昧推进` - 天干配偶星

2. **地支合** (在 `- DEBUG -` 区块):
   - `[无提示] XXX宫被合: X X合` - 地支六合
   - `[无提示] XXX宫被合: X X半合` - 地支半合

3. **宫位引动** (可选，在 `- HINTS -` 区块):
   - `[感情] 婚姻宫被合: ...`
   - `[感情] 夫妻宫被冲: ...`

---

## 测试案例

### Case 1: 2005-09-20 10:00 男

**测试年份**: 2028, 2029, 2030, 2031（未来5年感情信号）

| 年份 | 地支配偶星 | 天干配偶星 | 地支合 | 文件 |
|-----|-----------|-----------|--------|------|
| 2028 | ✅ | ❌ | ✅ 申巳合 | case1_2005_male_year_2028.txt |
| 2029 | ✅ | ❌ | ✅ 酉巳半合 | case1_2005_male_year_2029.txt |
| 2030 | ❌ | ✅ | ❌ | case1_2005_male_year_2030.txt |
| 2031 | ❌ | ✅ | ❌ | case1_2005_male_year_2031.txt |

**预期Q8输出**:
- 2028、2029年：地支配偶星 + 地支合
- 2030、2031年：天干配偶星

---

### Case 2: 2006-12-17 12:00 男

**测试年份**: 2022, 2023, 2024（过去5年感情状况）

| 年份 | 地支配偶星 | 天干配偶星 | 地支合 | 文件 |
|-----|-----------|-----------|--------|------|
| 2022 | ✅ | ❌ | ✅ 寅午半合 | case2_2006_male_year_2022.txt |
| 2023 | ✅ | ❌ | ✅ 卯戌合 | case2_2006_male_year_2023.txt |
| 2024 | ❌ | ✅ | ✅ 辰子半合 | case2_2006_male_year_2024.txt |

**预期Q4输出**:
- 2022、2023年：地支配偶星 + 地支合
- 2024年：天干配偶星 + 地支合 + 宫位引动

---

## 验证方法

### 1. 手动验证

运行程序并对比输出：

```bash
python -m bazi.cli --birth-dt "2005-09-20 10:00" --is-male
```

在输出中查找对应年份的区块，对比快照内容是否一致。

### 2. 自动化测试（待实现）

创建regression测试脚本：
1. 读取快照文件
2. 运行程序生成当前输出
3. 提取对应年份区块
4. 逐行对比，检测差异

---

## 重要提醒

1. **打印层是最终口径** - 所有功能都应该从打印层验证
2. **快照不会自动同步** - 这是固定的基准，代码改动后需要验证输出是否仍然匹配
3. **只看地支合** - 天干五合不算"合"
4. **地支配偶星是重点** - 代表"遇到对的人，可以结婚"

---

## 下一步

1. 基于这些快照实现Relationship Index增强
2. 实现Q8和Q4功能
3. 验证功能输出与快照一致
4. 创建自动化regression测试脚本
