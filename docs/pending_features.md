# å¾…å®šåŠŸèƒ½æ¸…å•

---

## âœ… Indexå¢å¼ºåŠŸèƒ½çŠ¶æ€ï¼ˆ2026-01-31å·²å®ç°ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ | ä½ç½® | è¯´æ˜ |
|------|------|------|------|
| **Relationship Index é…å¶æ˜Ÿæ£€æµ‹** | âœ… å·²å®ç° | `bazi/relationship_index.py` | å·²å¢åŠ  `spouse_star_in_gan`, `spouse_star_in_zhi`, `zhi_liuhe_combine`, `zhi_banhe_combine` ç±»å‹ï¼›å·²å¢åŠ  `years_by_type` å’Œ `last5_years_by_type` å­—æ®µ |
| **Dayun Index æœªæ¥ä¸¤æ­¥å¤§è¿** | âœ… å·²å®ç° | `bazi/request_index.py` | å·²å¢åŠ  `future_dayuns` å­—æ®µï¼ˆå— `future_allowed` é—¨æ§ï¼‰ |
| **Turning Points çª—å£** | âœ… å·²å®ç° | `bazi/request_index.py` | çª—å£å·²è°ƒæ•´ä¸ºï¼šè¿‡å»5å¹´ + æœªæ¥10å¹´ï¼›æ–°å¢ `past5_turning_points` å­—æ®µ |
| **Year Grade Index is_bad_year/is_change_year** | âœ… å·²å®ç° | `bazi/request_index.py` | å·²å¢åŠ  `is_bad_year`ï¼ˆY>=40ï¼‰å’Œ `is_change_year`ï¼ˆ25<=Y<40ï¼‰å­—æ®µ |

---

## ä¸€ã€Q1ï¼ˆæœ€è¿‘Nå¹´æ€ä¹ˆæ ·ï¼‰ç»†åŒ–éœ€æ±‚

### 1.1 å‡¶å¹´/å˜åŠ¨å¹´é’»å– hints

**éœ€æ±‚**ï¼š
- å¦‚æœæŸå¹´è¢«è¯†åˆ«ä¸º"å‡¶"æˆ–"æœ‰å˜åŠ¨"ï¼Œéœ€è¦é’»åˆ°é‚£å¹´çš„ year detailï¼Œç®€ç•¥å¤è¿° hints
- åœ¨ Q1 çš„è¾“å‡ºä¸­ï¼Œé™¤äº†å¹´åº¦è¯„çº§å¤–ï¼Œè¿˜è¦è¾“å‡ºè¯¥å¹´çš„ä¸»è¦ hints

**âš ï¸ æ³¨æ„ï¼šæœ‰ä¸¤å¥—åˆ¤æ–­æ ‡å‡†ï¼Œç”¨äºä¸åŒç›®çš„**

#### æ•´å¹´å‡¶å¹´/å˜åŠ¨å¹´åˆ¤æ–­ï¼ˆç”¨äº Index å¹´åº¦è¯„çº§ï¼‰

- **ä»£ç ä½ç½®**ï¼š`bazi/request_index.py` (424-427è¡Œ)
- **åˆ¤æ–­é€»è¾‘**ï¼š
  ```python
  # Y = total_risk_percent
  if Y >= 40.0:
      year_label = "å…¨å¹´ å‡¶ï¼ˆæ£˜æ‰‹/æ„å¤–ï¼‰"
  elif Y >= 25.0:
      year_label = "å…¨å¹´ æ˜æ˜¾å˜åŠ¨ï¼ˆå¯å…‹æœï¼‰"
  else:
      year_label = f"å¼€å§‹ {start_label}ï¼Œåæ¥ {later_label}"
  ```

#### åŠå¹´å‡¶/å˜åŠ¨åˆ¤æ–­ï¼ˆç”¨äº Year Detail å¼€å§‹/åæ¥è¯„çº§ï¼‰

- **ä»£ç ä½ç½®**ï¼š`bazi/year_detail.py` (104-143è¡Œ)
- **åˆ¤æ–­é€»è¾‘**ï¼š
  ```python
  # å¼€å§‹å‡¶ï¼šstart_good = False ä¸” risk_from_gan > 30
  # åæ¥å‡¶ï¼šlater_good = False ä¸” risk_from_zhi > 30
  # å¼€å§‹å˜åŠ¨ï¼šstart_good = None
  # åæ¥å˜åŠ¨ï¼šlater_good = None
  ```

**å®ç°æ–¹æ¡ˆ**ï¼š
- æ–‡ä»¶ï¼š`bazi/q1_recent_years.py`ï¼ˆæ–°å»ºï¼‰æˆ–åœ¨ç°æœ‰ chat_api ä¸­å¢å¼º
- æ•°æ®æ¥æºï¼š`facts.luck.groups[].liunian[year].hints`
- é€»è¾‘ï¼š
  1. éå† last5_years
  2. å¯¹æ¯å¹´è®¡ç®— half_year_grade (ä½¿ç”¨ `year_detail._compute_half_year_grade`)
  3. å¦‚æœ start_grade æˆ– later_grade æ˜¯"å‡¶"æˆ–"å˜åŠ¨"ï¼Œæå–è¯¥å¹´çš„ hints
  4. åœ¨ Q1 è¾“å‡ºä¸­ç®€ç•¥å±•ç¤º

**å®ç°éš¾åº¦**ï¼šâ˜…â˜…â˜†â˜†â˜†ï¼ˆä¸­ç­‰ï¼‰

---

### 1.2 å¤©å¹²äº”åˆå¼•å‘æ„Ÿæƒ…å˜åŠ¨æé†’

**éœ€æ±‚**ï¼š
- å¦‚æœ last 5 å¹´å†…å‡ºç°å¤©å¹²äº”åˆå¼•å‘çš„æ„Ÿæƒ…å˜åŠ¨ï¼Œåœ¨ Q1 è¾“å‡ºä¸­ç®€ç•¥æé†’

**åˆ¤æ–­æ ‡å‡†**ï¼ˆå·²åœ¨ç¨‹åºä¸­å®ç°ï¼‰ï¼š
- ä»£ç ä½ç½®ï¼š`bazi/marriage_wuhe.py` (56-147è¡Œ)
- åˆ¤æ–­é€»è¾‘ï¼šæ£€æµ‹ä¸¤ç§æƒ…å†µ
  - **ä»–äººäº‰åˆ**ï¼šé…å¶æ˜Ÿè¢«äº‰åˆ
    - hints text: "å¤©å¹²{'å®˜æ€æ˜Ÿ' if not is_male else 'è´¢æ˜Ÿ'}è¢«äº‰åˆï¼Œ{wuhe_name}åˆèµ°{'å®˜æ€æ˜Ÿ' if not is_male else 'è´¢æ˜Ÿ'}ï¼šæ„Ÿæƒ…ç«äº‰/ç¬¬ä¸‰è€…ä»‹å…¥çš„é£é™©ä¸Šå‡"
  - **å‘½ä¸»åŒåˆ**ï¼šå‘½ä¸»åˆä¸¤ä¸ªé…å¶æ˜Ÿ
    - hints text: "å‘½ä¸»åˆä¸¤ä¸ª{'å®˜æ€æ˜Ÿ' if not is_male else 'è´¢æ˜Ÿ'}ï¼Œ{wuhe_name}ï¼šæ›´å®¹æ˜“å‡ºç°ä¸‰æ–¹æ‹‰æ‰¯/ä¸‰è§’å…³ç³»å€¾å‘"
- è¿™äº›æç¤ºä¼šå‡ºç°åœ¨ `liunian[year].hints` ä¸­ï¼Œä»¥ `"å©šæ‹å˜åŒ–æé†’ï¼ˆå¦‚æ‹çˆ±ï¼‰ï¼š"` å¼€å¤´
- å…³é”®è¯ï¼š**"ç¬¬ä¸‰è€…ä»‹å…¥"**ã€**"ä¸‰è§’å…³ç³»"**ã€**"äº‰åˆ"**ã€**"åŒåˆ"**

**å®ç°æ–¹æ¡ˆ**ï¼š
- æ–‡ä»¶ï¼š`bazi/q1_recent_years.py`ï¼ˆæ–°å»ºï¼‰
- æ•°æ®æ¥æºï¼š`facts.luck.groups[].liunian[year].hints`
- é€»è¾‘ï¼š
  1. éå† last5_years
  2. æ£€æŸ¥æ¯å¹´çš„ hints ä¸­æ˜¯å¦åŒ…å«"å©šæ‹å˜åŒ–æé†’ï¼ˆå¦‚æ‹çˆ±ï¼‰"
  3. å¦‚æœæœ‰ï¼Œæå–å¹¶ç®€ç•¥å¤è¿°
  4. åœ¨ Q1 è¾“å‡ºä¸­æ±‡æ€»å±•ç¤º

**å®ç°éš¾åº¦**ï¼šâ˜…â˜†â˜†â˜†â˜†ï¼ˆç®€å•ï¼‰

---

### 1.3 Turning Points æ¡ä»¶è¾“å‡º

**éœ€æ±‚**ï¼š
- å¦‚æœå‰äº”å¹´å†…æœ‰ turning pointsï¼ˆå¥½è¿å˜ä¸€èˆ¬ æˆ– ä¸€èˆ¬å˜å¥½è¿ï¼‰ï¼Œå°±è¾“å‡º
- å¦‚æœå‰äº”å¹´å†…æ²¡æœ‰ turning pointsï¼Œä¸è¾“å‡º

**ç”¨æˆ·ç¡®è®¤**ï¼š
- **nearby turning points çª—å£**ï¼šè¿‡å»äº”å¹´å†… + æœªæ¥åå¹´å†…
- å› æ­¤éœ€è¦ï¼š
  1. ä» `index.turning_points.nearby` ä¸­è¿‡æ»¤å‡º"è¿‡å»äº”å¹´å†…"çš„è½¬æŠ˜ç‚¹
  2. å¦‚æœæœ‰ï¼Œå°±è¾“å‡ºï¼›å¦‚æœæ²¡æœ‰ï¼Œä¸è¾“å‡º

**å®ç°æ–¹æ¡ˆ**ï¼š
- æ–‡ä»¶ï¼š`bazi/request_index.py`ï¼ˆ`_build_turning_points_index`ï¼‰
- å½“å‰çŠ¶æ€ï¼š`index.turning_points.nearby` å·²ç»å­˜åœ¨ï¼Œä½†éœ€è¦ç¡®è®¤çª—å£èŒƒå›´
- é€»è¾‘ï¼š
  1. åœ¨ `_build_turning_points_index` ä¸­ï¼Œå¢åŠ  `past5_turning_points` å­—æ®µ
  2. è¿‡æ»¤ `nearby` ä¸­å¹´ä»½åœ¨ `[base_year - 5, base_year]` èŒƒå›´å†…çš„è½¬æŠ˜ç‚¹
  3. å¦‚æœ `past5_turning_points` éç©ºï¼Œåœ¨ Q1 è¾“å‡ºä¸­å±•ç¤º
  4. è¾“å‡ºæ ¼å¼ï¼šç®€æ´ç‰ˆ "2023å¹´ï¼šä¸€èˆ¬ â†’ å¥½è¿ï¼ˆåœ°æ”¯è½¬æŠ˜ï¼‰"

**å®ç°éš¾åº¦**ï¼šâ˜…â˜†â˜†â˜†â˜†ï¼ˆç®€å•ï¼‰

---

## äºŒã€å…­äº²åŠ©åŠ›è´¢æ˜Ÿ"çˆ¶äº²/çˆ¸çˆ¸"è¾“å‡ºè§„åˆ™ï¼ˆâœ… å·²å®ç° 2026-01-31ï¼‰

### 2.1 è§„åˆ™è¯´æ˜

**é»˜è®¤ä¸è¾“å‡ºçˆ¶äº²**ã€‚åªæœ‰æ»¡è¶³ä»¥ä¸‹**å…¨éƒ¨æ¡ä»¶**æ—¶æ‰è¾“å‡ºï¼š

1. è´¢æ˜Ÿæ˜¯ç”¨ç¥
2. å¤©å¹²æœ‰è´¢æ˜Ÿé€å‡ºï¼ˆå¹´/æœˆ/æ—¶æŸ±å¤©å¹²æœ‰æ­£è´¢æˆ–åè´¢ï¼‰
3. å¹´æœˆå¤©å¹²éƒ½ä¸æ˜¯æ¯”åŠ«ï¼ˆå¹´ORæœˆæœ‰æ¯”åŠ«å°±ä¸è¾“å‡ºï¼‰

### 2.2 ä»£ç ä½ç½®

- **åˆ¤æ–­å‡½æ•°**ï¼š`bazi/cli.py` â†’ `_should_output_father_in_cai()`
- **æ‰“å°å‡½æ•°**ï¼š`bazi/cli.py` â†’ `_get_liuqin_source()` å¢åŠ  `should_output_father` å‚æ•°

### 2.3 Regression æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**ï¼š`tests/regression/test_father_in_liuqin.py`

| æ¡ˆä¾‹ | é¢„æœŸ | åŸå›  |
|------|------|------|
| 2005-9-17 12:00å¥³ | âŒä¸è¾“å‡º | å¹´æœˆæŸ±å¤©å¹²æœ‰æ¯”åŠ« |
| 1965-10-4 6:00ç”· | âœ…è¾“å‡º | è´¢æ˜Ÿæ˜¯ç”¨ç¥ + å¤©å¹²é€è´¢æ˜Ÿ + å¹´æœˆæ— æ¯”åŠ« |
| 2005-2-5 12:00å¥³ | âœ…è¾“å‡º | å¤©å¹²é€äº†è´¢æ˜Ÿï¼Œæ—¶æŸ±åŠ«è´¢ä¸ç®— |
| 2006-3-28 12:00å¥³ | âŒä¸è¾“å‡º | å¹´æœˆæœ‰æ¯”åŠ« |
| 2003-11-28 2:00ç”· | âŒä¸è¾“å‡º | è´¢æ˜Ÿæ²¡æœ‰é€ |

**çŠ¶æ€**ï¼šâœ… å·²å®ç°

---

## ä¸‰ã€Index ç»“æ„å¢å¼ºï¼ˆä»˜è´¹åŠŸèƒ½ï¼‰

### 3.1 å½“å‰ Index ç»“æ„

**å½“å‰ Index åŒ…æ‹¬**ï¼ˆ`request_index.py`ï¼‰ï¼š
1. `meta`: æ—¶é—´èŒƒå›´ï¼ˆlast5_years, future3_years, scan_horizon_end_yearï¼‰
2. `dayun`: å¤§è¿ä¿¡æ¯ï¼ˆ**åªæœ‰å½“å‰å¤§è¿** `current_dayun_ref` + ç”¨ç¥äº’æ¢ï¼‰
3. `turning_points`: è½¬æŠ˜ç‚¹
4. `year_grade`: å¹´åº¦è¯„çº§ï¼ˆlast5 + future3ï¼Œfuture3 å—é—¨æ§ï¼‰
5. `good_year_search`: å¥½è¿å¹´æœç´¢ï¼ˆå—é—¨æ§ï¼‰
6. `relationship`: æ„Ÿæƒ…çª—å£ï¼ˆå…è´¹ç”¨æˆ·è£å‰ªæœªæ¥ä¿¡æ¯ï¼‰
7. `quota`: é…é¢ä¿¡æ¯ï¼ˆtier, future_allowed, blocked_reasonï¼‰
8. `personality`: æ€§æ ¼è½´ç´¢å¼•

**ä»˜è´¹æ•°æ®é—¨æ§**ï¼š
- é€šè¿‡ `future_allowed` å‚æ•°æ§åˆ¶æ˜¯å¦è£å‰ªæœªæ¥æ•°æ®
- Free ç”¨æˆ·ï¼š`future_allowed = False`ï¼Œè£å‰ªæ‰€æœ‰æœªæ¥æ•°æ®
- Paid ç”¨æˆ·ï¼š`future_allowed = True`ï¼ŒåŒ…å«æœªæ¥æ•°æ®

---

### 3.2 éœ€æ±‚ï¼šå¢åŠ æœªæ¥ä¸¤æ­¥å¤§è¿

**éœ€æ±‚**ï¼š
- ä»˜è´¹ååŒ…æ‹¬ï¼š**æœªæ¥ä¸¤æ­¥å¤§è¿** + æœªæ¥ä¸‰å¹´è¿åŠ¿ï¼ˆå·²æœ‰ï¼‰

**ç”¨æˆ·ç¡®è®¤**ï¼š
- **æœªæ¥ä¸¤æ­¥å¤§è¿**ï¼šä¸åŒ…æ‹¬å½“å‰ï¼Œä»å½“å‰ä¹‹åçš„ä¸¤æ­¥
  - ä¾‹å¦‚ï¼šå½“å‰æ˜¯å¤§è¿2ï¼ˆç™¸æœª 2019-2028ï¼‰ï¼Œæœªæ¥ä¸¤æ­¥æ˜¯å¤§è¿3ï¼ˆå£¬åˆ 2029-2038ï¼‰ã€å¤§è¿4ï¼ˆè¾›å·³ 2039-2048ï¼‰

**å®ç°æ–¹æ¡ˆ**ï¼š
- åœ¨ `dayun_index` é‡Œå¢åŠ  `future_dayuns` å­—æ®µ
- ç»“æ„ï¼š
  ```python
  dayun_index = {
      "current_dayun_ref": {
          "label": "ç™¸æœª",
          "start_year": 2019,
          "end_year": 2028,
          "fortune_label": "ä¸€èˆ¬",
      },
      "future_dayuns": [  # æ–°å¢å­—æ®µï¼ˆå— future_allowed é—¨æ§ï¼‰
          {
              "label": "å£¬åˆ",
              "start_year": 2029,
              "end_year": 2038,
              "fortune_label": "å¥½è¿",
          },
          {
              "label": "è¾›å·³",
              "start_year": 2039,
              "end_year": 2048,
              "fortune_label": "å¥½è¿",
          },
      ],
      "yongshen_swap": { ... },
      "fortune_label": "ä¸€èˆ¬",
  }
  ```

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`bazi/request_index.py`ï¼ˆ`_build_dayun_index`ï¼‰
- é€»è¾‘ï¼š
  1. æ‰¾åˆ°å½“å‰å¤§è¿çš„ indexï¼ˆä¾‹å¦‚ index = 2ï¼‰
  2. å¦‚æœ `future_allowed = True`ï¼Œå–ä¸‹ä¸¤ä¸ªå¤§è¿ï¼ˆindex+1, index+2ï¼‰
  3. å¦‚æœ `future_allowed = False`ï¼Œ`future_dayuns = []`

**å®ç°éš¾åº¦**ï¼šâ˜…â˜†â˜†â˜†â˜†ï¼ˆç®€å•ï¼‰

**çŠ¶æ€**ï¼š
- âœ… å·²ç¡®è®¤"æœªæ¥ä¸¤æ­¥å¤§è¿"çš„å®šä¹‰
- ğŸ”œ å¾…å®ç°

---

### 3.3 Turning Points çª—å£è°ƒæ•´

**ç”¨æˆ·ç¡®è®¤**ï¼š
- **nearby turning points** çª—å£ï¼šè¿‡å»äº”å¹´å†… + æœªæ¥åå¹´å†…

**å®ç°æ–¹æ¡ˆ**ï¼š
- æ–‡ä»¶ï¼š`bazi/request_index.py`ï¼ˆ`_build_turning_points_index`ï¼‰
- å½“å‰é€»è¾‘ï¼šéœ€è¦ç¡®è®¤ `nearby` çš„çª—å£èŒƒå›´
- è°ƒæ•´ä¸ºï¼š
  ```python
  # nearby: è¿‡å»5å¹´ + æœªæ¥10å¹´
  nearby_start = base_year - 5
  nearby_end = base_year + 10

  nearby_turning_points = [
      tp for tp in all_turning_points
      if nearby_start <= tp["year"] <= nearby_end
  ]
  ```

**å®ç°éš¾åº¦**ï¼šâ˜…â˜†â˜†â˜†â˜†ï¼ˆç®€å•ï¼‰

**çŠ¶æ€**ï¼š
- âœ… å·²ç¡®è®¤çª—å£èŒƒå›´
- ğŸ”œ å¾…å®ç°

---

## å››ã€å®æ–½ä¼˜å…ˆçº§

### ä¼˜å…ˆçº§å®šä¹‰

- **P0**ï¼šMVP æ ¸å¿ƒåŠŸèƒ½ï¼Œç”¨æˆ·æœ€å¸¸é—®çš„é—®é¢˜
- **P1**ï¼šé‡è¦åŠŸèƒ½ï¼Œä»˜è´¹ç”¨æˆ·éœ€è¦
- **P2**ï¼šæ¬¡è¦åŠŸèƒ½ï¼Œå¯åç»­è¿­ä»£
- **P3**ï¼šä¼˜åŒ–åŠŸèƒ½ï¼Œä¸å½±å“æ ¸å¿ƒä½“éªŒ

### åŠŸèƒ½ä¼˜å…ˆçº§è¡¨

| ä¼˜å…ˆçº§ | åŠŸèƒ½ | å®ç°éš¾åº¦ | çŠ¶æ€ | å¤‡æ³¨ |
|--------|------|---------|------|------|
| P0 | Q1 ç»†åŒ–ï¼šå‡¶å¹´/å˜åŠ¨å¹´é’»å– hints | â˜…â˜…â˜†â˜†â˜† | âœ… å·²æ˜ç¡® | åˆ¤æ–­æ ‡å‡†å·²åœ¨ç¨‹åºä¸­ |
| P0 | Q1 ç»†åŒ–ï¼šTurning Points æ¡ä»¶è¾“å‡º | â˜…â˜†â˜†â˜†â˜† | âœ… å·²æ˜ç¡® | çª—å£ï¼šè¿‡å»5å¹´+æœªæ¥10å¹´ |
| P1 | Q1 ç»†åŒ–ï¼šå¤©å¹²äº”åˆæ„Ÿæƒ…æé†’ | â˜…â˜†â˜†â˜†â˜† | âœ… å·²æ˜ç¡® | å…³é”®è¯ï¼šç¬¬ä¸‰è€…ã€äº‰åˆã€åŒåˆ |
| P1 | Index å¢å¼ºï¼šæœªæ¥ä¸¤æ­¥å¤§è¿ | â˜…â˜†â˜†â˜†â˜† | âœ… å·²æ˜ç¡® | ä»å½“å‰ä¹‹åçš„ä¸¤æ­¥ |
| P1 | Turning Points çª—å£è°ƒæ•´ | â˜…â˜†â˜†â˜†â˜† | âœ… å·²æ˜ç¡® | è¿‡å»5å¹´+æœªæ¥10å¹´ |
| P2 | æ¯”åŠ«å½±å“è´¢æ˜ŸåŠ©åŠ› | â˜…â˜†â˜†â˜†â˜† | âœ… å·²æ˜ç¡® | ä¸æ‰“å°çˆ¶äº²ï¼Œå¯æ‰“å°å¦»å­ |

---

## äº”ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… å·²ç¡®è®¤æ‰€æœ‰"å¾…æ˜ç¡®"çš„é—®é¢˜
2. æ¥ä¸‹æ¥æŒ‰ç…§ä¼˜å…ˆçº§å®æ–½è¿™äº›åŠŸèƒ½
3. ä¼˜å…ˆå®æ–½ P0 å’Œ P1 çº§åˆ«çš„åŠŸèƒ½
4. P2 çº§åˆ«çš„åŠŸèƒ½å¯ä»¥åç»­è¿­ä»£

---

## å…­ã€æŠ€æœ¯ç»†èŠ‚æ€»ç»“

### 6.1 å‡¶å¹´/å˜åŠ¨å¹´åˆ¤æ–­ï¼ˆyear_detail.py 104-143è¡Œï¼‰

```python
def _compute_half_year_grade(liunian: Dict[str, Any]) -> Dict[str, str]:
    start_good = liunian.get("start_good")
    later_good = liunian.get("later_good")
    risk_from_gan = liunian.get("risk_from_gan", 0.0)
    risk_from_zhi = liunian.get("risk_from_zhi", 0.0)

    # å¼€å§‹åˆ¤å®š
    if start_good is None:
        start_grade = "å˜åŠ¨"
    elif start_good:
        if risk_from_gan > 20:
            start_grade = "ä¸€èˆ¬"
        else:
            start_grade = "å¥½è¿"
    else:
        if risk_from_gan > 30:
            start_grade = "å‡¶"
        else:
            start_grade = "ä¸€èˆ¬"

    # åæ¥åˆ¤å®šï¼ˆé€»è¾‘ç›¸åŒï¼Œç”¨ later_good å’Œ risk_from_zhiï¼‰
    ...
```

### 6.2 å¤©å¹²äº”åˆæ„Ÿæƒ…å˜åŠ¨åˆ¤æ–­ï¼ˆmarriage_wuhe.py 56-147è¡Œï¼‰

- ä¸¤ç§æƒ…å†µï¼š
  1. **ä»–äººäº‰åˆ**ï¼šé…å¶æ˜Ÿè¢«äº‰åˆ
     - æ¡ä»¶ï¼šXï¼ˆé…å¶æ˜Ÿï¼‰å’Œ Yï¼ˆäº‰åˆå­—ï¼‰éƒ½å‡ºç°ï¼Œä¸”éƒ½ä¸æ˜¯æ—¥å¹²
     - hints: "å¤©å¹²è´¢æ˜Ÿ/å®˜æ€æ˜Ÿè¢«äº‰åˆï¼Œ{wuhe_name}åˆèµ°è´¢æ˜Ÿ/å®˜æ€æ˜Ÿï¼šæ„Ÿæƒ…ç«äº‰/ç¬¬ä¸‰è€…ä»‹å…¥çš„é£é™©ä¸Šå‡"
  2. **å‘½ä¸»åŒåˆ**ï¼šå‘½ä¸»åˆä¸¤ä¸ªé…å¶æ˜Ÿ
     - æ¡ä»¶ï¼šæ—¥å¹² = Yï¼Œä¸”å‡ºç°ä¸¤ä¸ª X
     - hints: "å‘½ä¸»åˆä¸¤ä¸ªè´¢æ˜Ÿ/å®˜æ€æ˜Ÿï¼Œ{wuhe_name}ï¼šæ›´å®¹æ˜“å‡ºç°ä¸‰æ–¹æ‹‰æ‰¯/ä¸‰è§’å…³ç³»å€¾å‘"

- è¿™äº› hints ä¼šä»¥ `"å©šæ‹å˜åŒ–æé†’ï¼ˆå¦‚æ‹çˆ±ï¼‰ï¼š{hint_text}"` çš„å½¢å¼å‡ºç°åœ¨ `liunian[year].hints` ä¸­

### 6.3 æ¯”åŠ«åˆ¤æ–­é€»è¾‘

```python
from .shishen import get_shishen

year_gan = bazi["year"]["gan"]
month_gan = bazi["month"]["gan"]
day_gan = bazi["day"]["gan"]

year_shishen = get_shishen(day_gan, year_gan)
month_shishen = get_shishen(day_gan, month_gan)

# åˆ¤æ–­å¹´æœˆå¤©å¹²æ˜¯å¦éƒ½æ˜¯æ¯”åŠ«
has_bijie_in_year_month = (
    year_shishen in ["æ¯”è‚©", "åŠ«è´¢"] and
    month_shishen in ["æ¯”è‚©", "åŠ«è´¢"]
)
```

### 6.4 å…­äº²åŠ©åŠ›è´¢æ˜Ÿæ¥æºä¿®æ”¹

å½“ `has_bijie_in_year_month = True` æ—¶ï¼š
- ç”·æ€§ï¼šå»æ‰"çˆ¶äº²/çˆ¸çˆ¸"ï¼Œä¿ç•™"å¦»å­/è€å©†/ä¼´ä¾£"å’Œé’±ä¸èµ„æº
- å¥³æ€§ï¼šå»æ‰"çˆ¶äº²/çˆ¸çˆ¸"ï¼Œåªä¿ç•™"é’±ä¸èµ„æº..."
