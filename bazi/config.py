# -*- coding: utf-8 -*-
"""日主强弱 + 用神 + 冲 相关配置。"""

from typing import Dict

# 位置权重（总和约 1.0）
POSITION_WEIGHTS: Dict[str, float] = {
    "year_gan":  0.10,
    "year_zhi":  0.10,
    "month_gan": 0.10,
    "month_zhi": 0.35,
    "day_gan":   0.00,  # 日干不参与给自己加分
    "day_zhi":   0.10,
    "hour_gan":  0.10,
    "hour_zhi":  0.15,
}

# 天干 → 五行
GAN_WUXING: Dict[str, str] = {
    "甲": "木", "乙": "木",
    "丙": "火", "丁": "火",
    "戊": "土", "己": "土",
    "庚": "金", "辛": "金",
    "壬": "水", "癸": "水",
}

# 地支 → 五行（主气）
ZHI_WUXING: Dict[str, str] = {
    "子": "水",
    "丑": "土",
    "寅": "木",
    "卯": "木",
    "辰": "土",
    "巳": "火",
    "午": "火",
    "未": "土",
    "申": "金",
    "酉": "金",
    "戌": "土",
    "亥": "水",
}

# 日主五行 → 其它五行的影响系数
# +1 = 生扶 / 同气；-1 = 泄 / 克 / 被克
RELATION_COEFF: Dict[str, Dict[str, float]] = {
    # 日主为火
    "火": {
        "木": +1.0,
        "火": +1.0,
        "土": -1.0,
        "金": -1.0,
        "水": -1.0,
    },
    # 日主为木
    "木": {
        "水": +1.0,
        "木": +1.0,
        "火": -1.0,
        "土": -1.0,
        "金": -1.0,
    },
    # 日主为金
    "金": {
        "土": +1.0,
        "金": +1.0,
        "水": -1.0,
        "木": -1.0,
        "火": -1.0,
    },
    # 日主为水
    "水": {
        "金": +1.0,
        "水": +1.0,
        "木": -1.0,
        "火": -1.0,
        "土": -1.0,
    },
    # 日主为土
    "土": {
        "火": +1.0,
        "土": +1.0,
        "金": -1.0,
        "水": -1.0,
        "木": -1.0,
    },
}

# 合法干支列表，用于校验
GAN_LIST = list("甲乙丙丁戊己庚辛壬癸")
ZHI_LIST = list("子丑寅卯辰巳午未申酉戌亥")

# 五行顺序（全局占比输出用）
ELEMENTS = ["木", "火", "土", "金", "水"]

# 五行克制关系（用于天克地冲判断）
# KE_MAP[e1] = e2 表示 e1 克 e2
KE_MAP: Dict[str, str] = {
    "木": "土",
    "土": "水",
    "水": "火",
    "火": "金",
    "金": "木",
}

# ===== 风险系数常量 =====

# 十神模式风险（流年自己触发的）
PATTERN_GAN_RISK_LIUNIAN = 15.0  # 流年天干层模式每组15%
PATTERN_ZHI_RISK_LIUNIAN = 15.0  # 流年地支层模式每组15%

# 十神模式风险（静态被激活的）
PATTERN_GAN_RISK_STATIC = 10.0  # 静态天干层模式每组10%
PATTERN_ZHI_RISK_STATIC = 10.0  # 静态地支层模式每组10%

# 冲的风险
CLASH_NORMAL_RISK = 10.0  # 普通冲
CLASH_GRAVE_RISK = 15.0   # 墓库冲（辰、戌、丑、未之间）

# 静态冲的风险（原基础风险的一半）
STATIC_CLASH_NORMAL_RISK = CLASH_NORMAL_RISK * 0.5  # 5.0
STATIC_CLASH_GRAVE_RISK = CLASH_GRAVE_RISK * 0.5    # 7.5

# 刑的风险（在punishment.py中定义，这里仅作引用说明）
# PUNISHMENT_NORMAL_RISK = 5.0  # 普通刑
# PUNISHMENT_GRAVE_RISK = 6.0   # 墓库刑

# 静态刑的风险（原基础风险的一半，在punishment.py中定义）
# STATIC_PUNISH_NORMAL_RISK = PUNISHMENT_NORMAL_RISK * 0.5  # 2.5
# STATIC_PUNISH_GRAVE_RISK = PUNISHMENT_GRAVE_RISK * 0.5    # 3.0

# 天克地冲额外风险
TIAN_KE_DI_CHONG_EXTRA_RISK = 10.0  # 天克地冲在冲基础上额外+10%

# 地支相冲表
ZHI_CHONG: Dict[str, str] = {
    "子": "午", "午": "子",
    "丑": "未", "未": "丑",
    "寅": "申", "申": "寅",
    "卯": "酉", "酉": "卯",
    "辰": "戌", "戌": "辰",
    "巳": "亥", "亥": "巳",
}

# 宫位映射：每一柱对应哪个"宫"
PILLAR_PALACE: Dict[str, str] = {
    "year":  "祖上宫（家庭出身、早年环境）",
    "month": "婚姻宫",
    "day":   "夫妻宫",
    "hour":  "事业家庭宫（工作 / 子女 / 后期家庭）",
}

# 宫位中文名称（用于显示）
PILLAR_PALACE_CN: Dict[str, str] = {
    "year":  "祖上宫",
    "month": "婚姻宫",
    "day":   "夫妻宫",
    "hour":  "事业家庭宫",
}

# 六合（地支相合）
ZHI_LIUHE: Dict[str, str] = {
    "子": "丑", "丑": "子",
    "寅": "亥", "亥": "寅",
    "卯": "戌", "戌": "卯",
    "辰": "酉", "酉": "辰",
    "巳": "申", "申": "巳",
    "午": "未", "未": "午",
}

# 三合（地支三合局）
ZHI_SANHE: Dict[str, List[str]] = {
    "申": ["申", "子", "辰"],  # 申子辰水局
    "子": ["申", "子", "辰"],
    "辰": ["申", "子", "辰"],
    "亥": ["亥", "卯", "未"],  # 亥卯未木局
    "卯": ["亥", "卯", "未"],
    "未": ["亥", "卯", "未"],
    "寅": ["寅", "午", "戌"],  # 寅午戌火局
    "午": ["寅", "午", "戌"],
    "戌": ["寅", "午", "戌"],
    "巳": ["巳", "酉", "丑"],  # 巳酉丑金局
    "酉": ["巳", "酉", "丑"],
    "丑": ["巳", "酉", "丑"],
}
